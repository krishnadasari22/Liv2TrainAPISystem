package com.televisory.utils;

public interface ShareholdingQueries {


	//String instituitionalQuery = "select (@id\\:=@id+1) as id,factset_entity_id, institution, perOS, position, mkt_val, report_date, source, curdate() as as_on, type ,display_order from (select factset_rollup_entity_id as factset_entity_id, tf_holding as position, (tf_holding / adj_shares_outstanding) * 100 as 'perOS', (tf_holding * adj_price) as 'mkt_val', tf_report_date as report_date, source_13f as source,entity_proper_name as institution, inst_13f_flag,sec_13f_flag,sec_13f_ca_flag,fds_uksr_flag,type ,display_order from (select factset_rollup_entity_id, tf_holding,tf_report_date,source_13f,entity_proper_name, inst_13f_flag,sec_13f_flag, sec_13f_ca_flag,fds_uksr_flag,type,display_order,p.adj_shares_outstanding as adj_shares_outstanding,p.adj_price as adj_price from (select case when fds_uksr_flag = 1 and source_13f in ('W','O') then case when type = 'stk' and own_master.tf_report_date > date_sub(curdate(),interval 18 month) then 1 else 2 end when own_master.inst_13f_flag = 1 and own_master.sec_13f_flag = 1 then case when type='13f' then 3 else 4 end when own_master.inst_13f_flag = 1 and own_master.sec_13f_ca_flag = 1 then 4 when own_master.inst_13f_flag = 0 or (own_master.sec_13f_flag = 0 and own_master.sec_13f_ca_flag = 0 ) then case when type='stk' and tf_holding is not null then 5 when type='sof' then 6 end end as display_order,own_master.* from (select all_sources.factset_rollup_entity_id, all_sources.tf_holding,all_sources.tf_report_date,all_sources.source_13f,e.entity_proper_name,i.fds_13f_flag as inst_13f_flag,oc.fds_13f_flag as sec_13f_flag,oc.fds_13f_ca_flag as sec_13f_ca_flag,oc.fds_uksr_flag,all_sources.fsym_id,all_sources.type from (select ci.factset_rollup_entity_id , sum(h.adj_holding) tf_holding , max(h.report_date) tf_report_date, '13f' as source_13f,'13f' as type ,h.fsym_id from own_v5_own_inst_13f_detail h join own_v5_own_ent_13f_combined_inst ci on ci.factset_filer_entity_id = h.factset_entity_id where h.report_date= ( select max(fh.report_date) as max_date from own_v5_own_ent_13f_filing_hist fh join own_v5_own_ent_13f_combined_inst c on c.factset_filer_entity_id = fh.factset_13f_filer_entity_id where fh.report_date >= date_sub(curdate(),interval 2 year) and c.factset_rollup_entity_id = ci.factset_rollup_entity_id group by c.factset_rollup_entity_id ) and h.fsym_id = :fsymid group by ci.factset_rollup_entity_id union all (select f.factset_inst_entity_id , sum(h.adj_holding) sof_holding , max(h.report_date) sof_report_date, 'Sum Of Funds' source_sof,'sof' as type ,h.fsym_id from own_v5_own_fund_detail h join own_v5_own_ent_funds f on f.factset_fund_id = h.factset_fund_id and f.active_flag = 1 where h.report_date = (select max(fh.report_date) as max_date from own_v5_own_ent_fund_filing_hist fh where fh.report_date >= date_sub(curdate(),interval 2 year) and fh.factset_fund_id=h.factset_fund_id group by fh.factset_fund_id) and h.fsym_id = :fsymid group by f.factset_inst_entity_id) union all (select h.factset_entity_id factset_stk_entity_id , h.position stk_holding , h.as_of_date stk_report_date , h.source_code stk_source,'stk' as type ,h.fsym_id from own_v5_own_inst_stakes_detail h join ( select max(d.as_of_date) max_report_date , d.factset_entity_id , d.fsym_id from own_v5_own_inst_stakes_detail d where d.fsym_id = :fsymid and d.as_of_date >= date_sub(curdate(),interval 2 year) group by d.factset_entity_id, d.fsym_id ) md on md.factset_entity_id = h.factset_entity_id and md.fsym_id = h.fsym_id and md.max_report_date = h.as_of_date where h.fsym_id = :fsymid )) all_sources join sym_v1_sym_entity e on e.factset_entity_id=all_sources.factset_rollup_entity_id left join own_v5_own_ent_institutions i on i.factset_entity_id = all_sources.factset_rollup_entity_id join own_v5_own_sec_coverage oc on oc.fsym_id = all_sources.fsym_id where oc.fsym_id=:fsymid order by fds_uksr_flag desc ,tf_report_date desc ,inst_13f_flag desc ,tf_report_date desc,sec_13f_flag desc,tf_report_date desc) own_master order by display_order, tf_report_date desc ) best_fit join (select * from own_v5_own_sec_prices where fsym_id=:fsymid and price_date = (select max(price_date) from own_v5_own_sec_prices where price_date between date_sub(curdate(),interval 2 year ) and curdate()))p on p.fsym_id=best_fit.fsym_id left join own_v5_own_ent_institutions i on i.factset_entity_id = best_fit.factset_rollup_entity_id left join ref_v2_entity_sub_type_map m on m.entity_sub_type_code = i.entity_sub_type where tf_holding is not null order by display_order asc,tf_report_date desc)x group by factset_rollup_entity_id order by tf_holding desc) y join (select @id\\:=0) as a ;";
	
	String instituitionalQuery = "select (@id\\:=@id+1) as id,factset_entity_id, institution, perOS, position, mkt_val, report_date, source, as_on_date, type ,display_order "
			+ " from (select factset_rollup_entity_id as factset_entity_id, tf_holding as position, (tf_holding / adj_shares_outstanding) * 100 as 'perOS', (tf_holding * adj_price) as 'mkt_val', tf_report_date as report_date, source_13f as source,entity_proper_name as institution, inst_13f_flag,sec_13f_flag,sec_13f_ca_flag,fds_uksr_flag, as_on_date, type ,display_order "
			+ " from (select factset_rollup_entity_id, tf_holding,tf_report_date,source_13f,entity_proper_name, inst_13f_flag,sec_13f_flag, sec_13f_ca_flag,fds_uksr_flag, case when p.price_date=(SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE  PRICE_DATE BETWEEN DATE_SUB(CURDATE(), INTERVAL 2 YEAR) AND CURDATE()) then CURDATE() else date_add(p.price_date,interval 1 month) end AS as_on_date, type,display_order,p.adj_shares_outstanding as adj_shares_outstanding,p.adj_price as adj_price "
			+ " from (select case when fds_uksr_flag = 1 and source_13f in ('W','O') then case when type = 'stk' and own_master.tf_report_date > date_sub(curdate(),interval 18 month) then 1 else case when type='sof' then 2 end end when own_master.inst_13f_flag = 1 and own_master.sec_13f_flag = 1 then case when type='13f' then 3 else 4 end when own_master.inst_13f_flag = 1 and own_master.sec_13f_ca_flag = 1 then 5 when own_master.inst_13f_flag = 0 or (own_master.sec_13f_flag = 0 and own_master.sec_13f_ca_flag = 0 ) then case when type='stk' and tf_holding is not null then 6 when type='sof' then 7 else 99 end end as display_order,own_master.* "
			+ " from (select all_sources.factset_rollup_entity_id, all_sources.tf_holding,all_sources.tf_report_date,all_sources.source_13f,e.entity_proper_name,i.fds_13f_flag as inst_13f_flag,oc.fds_13f_flag as sec_13f_flag,oc.fds_13f_ca_flag as sec_13f_ca_flag,oc.fds_uksr_flag,all_sources.fsym_id,all_sources.type "
			+ " from (select ci.factset_rollup_entity_id , sum(h.adj_holding) tf_holding , max(h.report_date) tf_report_date, '13f' as source_13f,'13f' as type ,h.fsym_id "
			+ " from own_v5_own_inst_13f_detail h join own_v5_own_ent_13f_combined_inst ci on ci.factset_filer_entity_id = h.factset_entity_id where h.report_date= ( select max(fh.report_date) as max_date "
			+ " from own_v5_own_ent_13f_filing_hist fh join own_v5_own_ent_13f_combined_inst c on c.factset_filer_entity_id = fh.factset_13f_filer_entity_id where fh.report_date BETWEEN DATE_SUB((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 2 YEAR) AND  DATE_Add((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 1 month) and c.factset_rollup_entity_id = ci.factset_rollup_entity_id group by c.factset_rollup_entity_id ) and h.fsym_id = :fsymid group by ci.factset_rollup_entity_id "
			+ " union all ( select factset_inst_entity_id, sum(d.adj_holding) as sof_holding, max(d.report_date) as sof_report_date, 'sof' as source_sof,'sof' as type ,d.fsym_id from (select max(report_date) as report_date, a.factset_fund_id, entity_proper_name, fsym_id from own_v5_own_fund_detail a join sym_v1_sym_entity b on a.factset_fund_id = b.factset_entity_id where report_date BETWEEN DATE_SUB((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 2 YEAR) AND  DATE_Add((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 1 month) and fsym_id = :fsymid and adj_holding is not null group by a.factset_fund_id, fsym_id, entity_proper_name ) a join own_v5_own_ent_funds b on a.factset_fund_id = b.factset_fund_id left join sym_v1_sym_entity c on b.factset_inst_entity_id = c.factset_entity_id join own_v5_own_fund_detail d on a.factset_fund_id = d.factset_fund_id and a.report_date = d.report_date and a.fsym_id = d.fsym_id left join sym_v1_sym_coverage e on d.fsym_id = e.fsym_id group by factset_inst_entity_id) "
			+ " union all (select h.factset_entity_id factset_stk_entity_id , h.position stk_holding , h.as_of_date stk_report_date , h.source_code stk_source,'stk' as type ,h.fsym_id from own_v5_own_inst_stakes_detail h join ( select max(d.as_of_date) max_report_date , d.factset_entity_id , d.fsym_id from own_v5_own_inst_stakes_detail d where d.fsym_id = :fsymid and d.as_of_date BETWEEN DATE_SUB((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 2 YEAR) AND  DATE_Add((SELECT MAX(PRICE_DATE) FROM factset.own_v5_own_sec_prices WHERE fsym_id=:fsymid), INTERVAL 1 month) group by d.factset_entity_id, d.fsym_id ) md on md.factset_entity_id = h.factset_entity_id and md.fsym_id = h.fsym_id and md.max_report_date = h.as_of_date where h.fsym_id = :fsymid )) all_sources join sym_v1_sym_entity e on e.factset_entity_id=all_sources.factset_rollup_entity_id left join own_v5_own_ent_institutions i on i.factset_entity_id = all_sources.factset_rollup_entity_id join own_v5_own_sec_coverage oc on oc.fsym_id = all_sources.fsym_id where oc.fsym_id=:fsymid order by fds_uksr_flag desc ,tf_report_date desc ,inst_13f_flag desc ,tf_report_date desc,sec_13f_flag desc,tf_report_date desc) own_master order by display_order, tf_report_date desc ) best_fit join (select * from own_v5_own_sec_prices where fsym_id=:fsymid and price_date = (select max(price_date) from own_v5_own_sec_prices where fsym_id = :fsymid))p on p.fsym_id=best_fit.fsym_id left join own_v5_own_ent_institutions i on i.factset_entity_id = best_fit.factset_rollup_entity_id left join ref_v2_entity_sub_type_map m on m.entity_sub_type_code = i.entity_sub_type where tf_holding is not null order by display_order asc,tf_report_date desc)x group by factset_rollup_entity_id order by tf_holding desc) y join (select @id\\:=0) as a";
}


